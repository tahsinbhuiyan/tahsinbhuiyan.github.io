<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Snake Arena MEGA 2000× | Tahsin Bhuiyan</title>
<style>
  :root {
    --bg: #020617;
    --wall1: #ff3b3b;
    --wall2: #ffffff;
    --snake-primary: #22c55e;
    --snake-secondary: #16a34a;
    --food-normal: #22c55e;
    --food-gold: #facc15;
    --food-poison: #7c3aed;
    --ui: #22c55e;
  }
  * {
    box-sizing: border-box;
    margin: 0; padding: 0;
  }
  body {
    background: radial-gradient(circle, #020617, #000);
    color: var(--ui);
    font-family: system-ui, Arial;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    user-select: none;
  }
  h1 {
    font-size: 14px;
    opacity: 0.8;
    margin: 6px 0 2px;
  }
  #hud {
    display: flex;
    gap: 14px;
    font-size: 13px;
    margin-bottom: 4px;
  }
  canvas {
    background: #000;
    border-radius: 18px;
    box-shadow: 0 0 40px rgba(34, 197, 94, 0.25);
    touch-action: none;
  }
  #over {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 48px;
    font-weight: 900;
    color: red;
    opacity: 0;
    pointer-events: none;
    text-shadow: 0 0 30px red;
    transition: opacity 0.5s ease;
  }
  #over.show {
    opacity: 1;
    pointer-events: auto;
  }
  #panel {
    display: flex;
    gap: 8px;
    font-size: 12px;
    margin-top: 6px;
  }
  .btn {
    background: #020617;
    border: 1px solid var(--ui);
    color: var(--ui);
    padding: 6px 12px;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s;
  }
  .btn:hover {
    background: var(--ui);
    color: #000;
  }
  #pad {
    margin-top: 10px;
    display: grid;
    grid-template-columns: 60px 60px 60px;
    grid-template-rows: 60px 60px 60px;
    gap: 8px;
    touch-action: none;
  }
  .pad {
    border-radius: 14px;
    border: 3px solid var(--ui);
    color: var(--ui);
    background: #020617;
    font-size: 28px;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    cursor: pointer;
    box-shadow: 0 0 8px var(--ui);
    transition: background 0.3s, color 0.3s;
  }
  .pad:active {
    background: var(--ui);
    color: #000;
  }
</style>
</head>
<body>
<h1>Creator: TAHSIN BHUIYAN</h1>
<div id="hud">
  <div>Player: <span id="pname"></span></div>
  <div>Score: <span id="score">0</span></div>
  <div>High: <span id="high">0</span></div>
</div>
<div style="position:relative;">
  <canvas id="game" width="360" height="520"></canvas>
  <div id="over">GAME OVER</div>
</div>
<div id="panel">
  <button class="btn" onclick="pauseResume()"
    >Pause / Resume</button
  >
  <button class="btn" onclick="reset()">Restart</button>
  <button class="btn" onclick="nextSkin()">Skin</button>
</div>
<div id="pad">
  <div></div>
  <button class="pad" data-dir="0,-1">▲</button>
  <div></div>
  <button class="pad" data-dir="-1,0">◀</button>
  <div></div>
  <button class="pad" data-dir="1,0">▶</button>
  <div></div>
  <button class="pad" data-dir="0,1">▼</button>
  <div></div>
</div>

<script>
/* ========== STORAGE ========== */
let name = localStorage.getItem("snakeName");
if (!name) {
  name = prompt("Your name?") || "Player";
  localStorage.setItem("snakeName", name);
}
document.getElementById("pname").textContent = name;

let high = +localStorage.getItem("snakeHigh") || 0;
document.getElementById("high").textContent = high;

let skin = +localStorage.getItem("snakeSkin") || 0;
const skins = [
  ["#22c55e", "#16a34a"],
  ["#facc15", "#eab308"],
  ["#ff3b3b", "#b91c1c"],
];

/* ========== CANVAS ========== */
const c = document.getElementById("game");
const g = c.getContext("2d");
const GRID = 16;
const COL = c.width / GRID;
const ROW = c.height / GRID;

/* ========== GAME VARIABLES ========== */
let snake,
  food,
  dir,
  nextDir,
  score,
  speed,
  run,
  state = "PLAY";
let walls = [];
let animationFrame;

/* ========== RESET GAME ========== */
function reset() {
  snake = [
    { x: 6, y: 10 },
    { x: 5, y: 10 },
    { x: 4, y: 10 },
  ];
  dir = { x: 1, y: 0 };
  nextDir = { x: 1, y: 0 };
  score = 0;
  speed = 10;
  run = true;
  state = "PLAY";
  food = spawnFood();
  buildWalls();
  document.getElementById("over").classList.remove("show");
}
reset();

/* ========== WALLS ========== */
function buildWalls() {
  walls = [];
  for (let i = 0; i < COL; i++) {
    walls.push({ x: i, y: 0 }, { x: i, y: ROW - 1 });
  }
  for (let i = 0; i < ROW; i++) {
    walls.push({ x: 0, y: i }, { x: COL - 1, y: i });
  }
  for (let y = 6; y < ROW - 6; y++) {
    walls.push({ x: 8, y }, { x: COL - 9, y });
  }
}

/* ========== SPAWN FOOD ========== */
function spawnFood() {
  let f;
  do {
    f = {
      x: randInt(COL),
      y: randInt(ROW),
      t: Math.random() < 0.7 ? "n" : Math.random() < 0.85 ? "g" : "p",
    };
  } while (hit(f));
  return f;
}

/* ========== CHECK COLLISIONS ========== */
function hit(p) {
  return (
    snake.some((s) => s.x == p.x && s.y == p.y) ||
    walls.some((w) => w.x == p.x && w.y == p.y)
  );
}

/* ========== DIRECTION SET ========== */
function dirSet(x, y) {
  if (dir.x + x === 0 && dir.y + y === 0) return; // No reverse
  nextDir = { x, y };
}

/* ========== KEYBOARD INPUT ========== */
addEventListener("keydown", (e) => {
  if (state !== "PLAY") return;
  if (e.key === "ArrowUp") dirSet(0, -1);
  else if (e.key === "ArrowDown") dirSet(0, 1);
  else if (e.key === "ArrowLeft") dirSet(-1, 0);
  else if (e.key === "ArrowRight") dirSet(1, 0);
});

/* ========== TOUCHPAD INPUT ========== */
const pads = document.querySelectorAll(".pad");
pads.forEach((pad) => {
  pad.addEventListener("click", () => {
    if (state !== "PLAY") return;
    const [x, y] = pad.dataset.dir.split(",").map(Number);
    dirSet(x, y);
  });
});

/* ========== SWIPE SUPPORT ========== */
let touchStartX, touchStartY;
c.addEventListener("touchstart", (e) => {
  if (state !== "PLAY") return;
  const touch = e.touches[0];
  touchStartX = touch.clientX;
  touchStartY = touch.clientY;
});
c.addEventListener("touchmove", (e) => {
  if (state !== "PLAY") return;
  const touch = e.touches[0];
  const dx = touch.clientX - touchStartX;
  const dy = touch.clientY - touchStartY;
  if (Math.abs(dx) > 20 || Math.abs(dy) > 20) {
    if (Math.abs(dx) > Math.abs(dy)) {
      dirSet(dx > 0 ? 1 : -1, 0);
    } else {
      dirSet(0, dy > 0 ? 1 : -1);
    }
    touchStartX = touch.clientX;
    touchStartY = touch.clientY;
  }
});

/* ========== GAME LOOP ========== */
let lastTime = 0,
  acc = 0,
  step = 1000 / 60;
function loop(time) {
  animationFrame = requestAnimationFrame(loop);
  acc += time - lastTime;
  lastTime = time;
  while (acc > 1000 / speed && state === "PLAY") {
    update();
    acc -= 1000 / speed;
  }
  draw();
}
animationFrame = requestAnimationFrame(loop);

/* ========== UPDATE LOGIC ========== */
function update() {
  dir = nextDir;
  let head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
  if (hit(head)) {
    gameOver();
    return;
  }
  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    score += food.t === "g" ? 5 : food.t === "p" ? -2 : 1;
    speed += 0.3;
    food = spawnFood();
    if (score > high) {
      high = score;
      localStorage.setItem("snakeHigh", high);
      document.getElementById("high").textContent = high;
    }
  } else {
    snake.pop();
  }

  document.getElementById("score").textContent = score;
}

/* ========== DRAW SNAKE WITH SMOOTH CURVES ========== */
function draw() {
  g.clearRect(0, 0, c.width, c.height);

  // Draw walls
  walls.forEach((w) => {
    g.fillStyle = w.y % 2 ? getVar("--wall1") : getVar("--wall2");
    g.fillRect(w.x * GRID, w.y * GRID, GRID, GRID);
  });

  // Draw food with pulse glow
  const pulse = 0.6 + 0.4 * Math.sin(Date.now() / 300);
  g.fillStyle =
    food.t === "n"
      ? getVar("--food")
      : food.t === "g"
      ? getVar("--gold")
      : getVar("--poison");
  g.shadowColor = g.fillStyle;
  g.shadowBlur = 15 * pulse;
  g.beginPath();
  g.arc((food.x + 0.5) * GRID, (food.y + 0.5) * GRID, GRID / 2, 0, Math.PI * 2);
  g.fill();
  g.shadowBlur = 0;

  // Draw snake with gradient & rounded segments
  for (let i = 0; i < snake.length; i++) {
    const s = snake[i];
    const x = s.x * GRID;
    const y = s.y * GRID;
    let color = i === 0 ? getVar("--snake-primary") : getVar("--snake-secondary");

    // Create gradient for body segments
    if (i > 0) {
      const grad = g.createLinearGradient(x, y, x + GRID, y + GRID);
      grad.addColorStop(0, getVar("--snake-primary"));
      grad.addColorStop(1, getVar("--snake-secondary"));
      color = grad;
    }
    g.fillStyle = color;
    g.shadowColor = color;
    g.shadowBlur = 10;
    g.beginPath();
    g.moveTo(x + GRID / 2, y + GRID / 6);
    g.bezierCurveTo(x + GRID * 0.9, y, x + GRID * 0.9, y + GRID, x + GRID / 2, y + GRID * 5 / 6);
    g.bezierCurveTo(x + GRID * 0.1, y + GRID, x + GRID * 0.1, y, x + GRID / 2, y + GRID / 6);
    g.fill();
    g.shadowBlur = 0;
  }
}

function getVar(v) {
  return getComputedStyle(document.documentElement).getPropertyValue(v);
}
function randInt(n) {
  return Math.floor(Math.random() * n);
}

/* ========== UI FUNCTIONS ========== */
function gameOver() {
  state = "OVER";
  document.getElementById("over").classList.add("show");
}
function pauseResume() {
  if (state === "PLAY") state = "PAUSE";
  else if (state === "PAUSE") state = "PLAY";
}
function nextSkin() {
  skin = (skin + 1) % skins.length;
  localStorage.setItem("snakeSkin", skin);
}
</script>
</body>
   </html>
